# å…³é”®ç»“æžœè¿›åº¦åŽ†å²è®°å½•åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

ä¸ºå¯æ˜Žæ˜Ÿå¹³å°çš„OKRç³»ç»Ÿæ·»åŠ äº†å®Œæ•´çš„è¿›åº¦åŽ†å²è®°å½•åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿›åº¦æäº¤é¡µé¢æŸ¥çœ‹å…³é”®ç»“æžœçš„åŽ†æ¬¡æäº¤è®°å½•ï¼ŒåŒ…æ‹¬è¿›åº¦å˜åŒ–ã€æäº¤æ—¶é—´å’Œæè¿°ä¿¡æ¯ã€‚

## ä¸»è¦ç‰¹æ€§

### 1. è¿›åº¦åŽ†å²è®°å½•å­˜å‚¨

#### æ•°æ®è¡¨è®¾è®¡
- **è¡¨å**: `progress_history`
- **ä¸»è¦å­—æ®µ**:
  - `okr_id`: å…³è”çš„OKR ID
  - `key_result_index`: å…³é”®ç»“æžœåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•
  - `key_result_text`: å…³é”®ç»“æžœæ–‡æœ¬å¿«ç…§
  - `progress`: è¿›åº¦ç™¾åˆ†æ¯” (0-100)
  - `progress_description`: è¿›åº¦æè¿°
  - `previous_progress`: ä¸Šä¸€æ¬¡çš„è¿›åº¦å€¼
  - `created_at`: æäº¤æ—¶é—´

#### è‡ªåŠ¨è®°å½•æœºåˆ¶
- æ¯æ¬¡æ›´æ–°å…³é”®ç»“æžœè¿›åº¦æ—¶è‡ªåŠ¨ä¿å­˜åŽ†å²è®°å½•
- æ”¯æŒå•ä¸ªå’Œæ‰¹é‡è¿›åº¦æ›´æ–°çš„åŽ†å²è®°å½•
- è®°å½•è¿›åº¦å˜åŒ–é‡ï¼ˆä¸Žä¸Šæ¬¡è¿›åº¦çš„å·®å€¼ï¼‰

### 2. åŽ†å²è®°å½•æŸ¥è¯¢

#### APIæŽ¥å£
```
GET /api/okr/progress-history?okrId={okrId}&keyResultIndex={index}
```

#### æŸ¥è¯¢ç‰¹æ€§
- æŒ‰æ—¶é—´å€’åºæŽ’åˆ—ï¼ˆæœ€æ–°è®°å½•åœ¨å‰ï¼‰
- é™åˆ¶æœ€å¤šè¿”å›ž50æ¡è®°å½•
- æ”¯æŒç”¨æˆ·æƒé™éªŒè¯

### 3. ç”¨æˆ·ç•Œé¢å¢žå¼º

#### è¿›åº¦æäº¤æ¨¡æ€æ¡†å¢žå¼º
- **åŽ†å²è®°å½•æŒ‰é’®**: åœ¨æ¨¡æ€æ¡†æ ‡é¢˜æ æ·»åŠ åŽ†å²å›¾æ ‡æŒ‰é’®
- **å¯æŠ˜å æ˜¾ç¤º**: ç‚¹å‡»æŒ‰é’®åˆ‡æ¢åŽ†å²è®°å½•æ˜¾ç¤º/éšè—
- **æ‡’åŠ è½½**: åªæœ‰åœ¨ç”¨æˆ·ç‚¹å‡»æŸ¥çœ‹æ—¶æ‰åŠ è½½åŽ†å²æ•°æ®

#### åŽ†å²è®°å½•æ˜¾ç¤ºåŒºåŸŸ
- **è®°å½•åˆ—è¡¨**: æ˜¾ç¤ºæ‰€æœ‰åŽ†å²æäº¤è®°å½•
- **è¿›åº¦å˜åŒ–**: æ˜¾ç¤ºè¿›åº¦å¢žå‡æƒ…å†µï¼Œç”¨é¢œè‰²å’Œç®­å¤´æ ‡è¯†
- **æ—¶é—´æˆ³**: æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å…·ä½“æ—¶é—´
- **æè¿°ä¿¡æ¯**: æ˜¾ç¤ºç”¨æˆ·æäº¤æ—¶çš„è¿›åº¦æè¿°
- **æ»šåŠ¨åŒºåŸŸ**: æ”¯æŒæ»šåŠ¨æŸ¥çœ‹æ›´å¤šåŽ†å²è®°å½•

## æŠ€æœ¯å®žçŽ°

### æ•°æ®åº“ç»“æž„

```sql
CREATE TABLE public.progress_history (
    id BIGSERIAL PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    okr_id UUID REFERENCES public.okrs(id) ON DELETE CASCADE,
    key_result_index INTEGER NOT NULL,
    key_result_text TEXT NOT NULL,
    progress INTEGER NOT NULL CHECK (progress >= 0 AND progress <= 100),
    progress_description TEXT,
    previous_progress INTEGER,
    created_at TIMESTAMPTZ DEFAULT now()
);
```

### APIç«¯ç‚¹

#### 1. æŸ¥è¯¢åŽ†å²è®°å½•
```typescript
GET /api/okr/progress-history
å‚æ•°: okrId, keyResultIndex
è¿”å›ž: ProgressHistory[]
```

#### 2. è‡ªåŠ¨ä¿å­˜åŽ†å²è®°å½•
- åœ¨ `/api/okr/update-progress` ä¸­è‡ªåŠ¨è§¦å‘
- å•ä¸ªæ›´æ–°å’Œæ‰¹é‡æ›´æ–°éƒ½æ”¯æŒ
- å¤±è´¥ä¸å½±å“ä¸»è¦åŠŸèƒ½

### ç±»åž‹å®šä¹‰

```typescript
export interface ProgressHistory {
  id: number
  user_id: string
  okr_id: string
  key_result_index: number
  key_result_text: string
  progress: number
  progress_description?: string
  previous_progress?: number
  created_at: string
}
```

## ç”¨æˆ·ä½“éªŒè®¾è®¡

### äº¤äº’æµç¨‹

1. **æŸ¥çœ‹åŽ†å²è®°å½•**
   ```
   ç‚¹å‡»å…³é”®ç»“æžœ â†’ æ‰“å¼€è¿›åº¦æäº¤æ¨¡æ€æ¡† â†’ ç‚¹å‡»åŽ†å²å›¾æ ‡ â†’ æŸ¥çœ‹åŽ†å²è®°å½•
   ```

2. **åŽ†å²è®°å½•æ˜¾ç¤º**
   ```
   åŠ è½½åŠ¨ç”» â†’ æ˜¾ç¤ºè®°å½•åˆ—è¡¨ â†’ æ»šåŠ¨æŸ¥çœ‹æ›´å¤š â†’ ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­
   ```

### è§†è§‰è®¾è®¡

#### è¿›åº¦å˜åŒ–æŒ‡ç¤º
- ðŸŸ¢ **è¿›åº¦å¢žåŠ **: ç»¿è‰²ç®­å¤´å‘ä¸Š + å¢žåŠ çš„ç™¾åˆ†æ¯”
- ðŸ”´ **è¿›åº¦å‡å°‘**: çº¢è‰²ç®­å¤´å‘ä¸‹ + å‡å°‘çš„ç™¾åˆ†æ¯”  
- âšª **è¿›åº¦ä¸å˜**: ç°è‰²æ¨ªçº¿ + 0%

#### æ—¶é—´æ˜¾ç¤º
- ðŸ“… **æ—¶é—´æ ¼å¼**: YYYY-MM-DD HH:mm:ss
- ðŸ• **æ—¶é’Ÿå›¾æ ‡**: å¢žå¼ºæ—¶é—´ä¿¡æ¯çš„å¯è¯†åˆ«æ€§

#### å¸ƒå±€è®¾è®¡
- **ç´§å‡‘å¸ƒå±€**: æœ€å¤§åŒ–ä¿¡æ¯å¯†åº¦
- **æ¸…æ™°åˆ†å‰²**: æ¯æ¡è®°å½•ä¹‹é—´æœ‰åˆ†å‰²çº¿
- **æ‚¬åœæ•ˆæžœ**: é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯å˜è‰²

## åŠŸèƒ½ç‰¹ç‚¹

### 1. æ•°æ®å®Œæ•´æ€§
- **æ–‡æœ¬å¿«ç…§**: ä¿å­˜å…³é”®ç»“æžœæ–‡æœ¬ï¼Œé˜²æ­¢OKRä¿®æ”¹åŽåŽ†å²ä¸¢å¤±
- **è¿›åº¦å˜åŒ–**: è®°å½•æ¯æ¬¡å˜åŒ–çš„å…·ä½“æ•°å€¼
- **æ—¶é—´æˆ³**: ç²¾ç¡®è®°å½•æ¯æ¬¡æäº¤çš„æ—¶é—´

### 2. æ€§èƒ½ä¼˜åŒ–
- **æ‡’åŠ è½½**: åªæœ‰åœ¨éœ€è¦æ—¶æ‰åŠ è½½åŽ†å²æ•°æ®
- **æ•°æ®é™åˆ¶**: æœ€å¤šæ˜¾ç¤º50æ¡è®°å½•ï¼Œé¿å…æ€§èƒ½é—®é¢˜
- **ç´¢å¼•ä¼˜åŒ–**: æ•°æ®åº“ç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½

### 3. ç”¨æˆ·å‹å¥½
- **å¯é€‰æ˜¾ç¤º**: åŽ†å²è®°å½•é»˜è®¤éšè—ï¼ŒæŒ‰éœ€æ˜¾ç¤º
- **åŠ è½½çŠ¶æ€**: æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **é”™è¯¯å¤„ç†**: åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½æç¤º

## ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹è¿›åº¦åŽ†å²
1. ç‚¹å‡»ä»»æ„å…³é”®ç»“æžœæ‰“å¼€è¿›åº¦æäº¤æ¨¡æ€æ¡†
2. ç‚¹å‡»æ ‡é¢˜æ å³ä¾§çš„åŽ†å²å›¾æ ‡ ðŸ“Š
3. æŸ¥çœ‹åŽ†å²è®°å½•åˆ—è¡¨ï¼ŒåŒ…æ‹¬ï¼š
   - æ¯æ¬¡æäº¤çš„è¿›åº¦ç™¾åˆ†æ¯”
   - ä¸Žä¸Šæ¬¡ç›¸æ¯”çš„å˜åŒ–é‡
   - æäº¤æ—¶é—´
   - è¿›åº¦æè¿°ï¼ˆå¦‚æžœæœ‰ï¼‰
4. æ»šåŠ¨æŸ¥çœ‹æ›´å¤šåŽ†å²è®°å½•
5. å†æ¬¡ç‚¹å‡»åŽ†å²å›¾æ ‡æˆ–å…³é—­æ¨¡æ€æ¡†éšè—åŽ†å²è®°å½•

### åŽ†å²è®°å½•ä¿¡æ¯è§£è¯»
- **è¿›åº¦å€¼**: å½“æ¬¡æäº¤çš„è¿›åº¦ç™¾åˆ†æ¯”
- **å˜åŒ–ç®­å¤´**: 
  - â¬†ï¸ ç»¿è‰²ï¼šè¿›åº¦å¢žåŠ 
  - â¬‡ï¸ çº¢è‰²ï¼šè¿›åº¦å‡å°‘
  - âž– ç°è‰²ï¼šè¿›åº¦ä¸å˜
- **å˜åŒ–æ•°å€¼**: ä¸Žä¸Šæ¬¡æäº¤ç›¸æ¯”çš„å˜åŒ–é‡
- **æ—¶é—´æˆ³**: æäº¤çš„å…·ä½“æ—¶é—´
- **æè¿°**: ç”¨æˆ·æäº¤æ—¶å¡«å†™çš„è¿›åº¦è¯´æ˜Ž

## æ•°æ®å®‰å…¨

### æƒé™æŽ§åˆ¶
- **è¡Œçº§å®‰å…¨**: ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è¿›åº¦åŽ†å²
- **èº«ä»½éªŒè¯**: æ‰€æœ‰APIéƒ½éœ€è¦ç”¨æˆ·ç™»å½•
- **æ•°æ®éš”ç¦»**: ä¸åŒç”¨æˆ·çš„æ•°æ®å®Œå…¨éš”ç¦»

### æ•°æ®ä¿æŠ¤
- **çº§è”åˆ é™¤**: ç”¨æˆ·æˆ–OKRåˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†ç›¸å…³åŽ†å²è®°å½•
- **æ•°æ®éªŒè¯**: è¿›åº¦å€¼èŒƒå›´éªŒè¯ (0-100)
- **é”™è¯¯å¤„ç†**: åŽ†å²è®°å½•ä¿å­˜å¤±è´¥ä¸å½±å“ä¸»åŠŸèƒ½

## åŽç»­æ‰©å±•å»ºè®®

1. **æ•°æ®åˆ†æž**: æ·»åŠ è¿›åº¦è¶‹åŠ¿å›¾è¡¨
2. **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒå¯¼å‡ºåŽ†å²è®°å½•ä¸ºExcel/PDF
3. **æé†’åŠŸèƒ½**: é•¿æ—¶é—´æœªæ›´æ–°è¿›åº¦çš„æé†’
4. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡åˆ é™¤åŽ†å²è®°å½•
5. **æœç´¢è¿‡æ»¤**: æŒ‰æ—¶é—´èŒƒå›´æˆ–å…³é”®è¯æœç´¢åŽ†å²è®°å½•
6. **ç»Ÿè®¡ä¿¡æ¯**: æ˜¾ç¤ºå¹³å‡è¿›åº¦ã€æ›´æ–°é¢‘çŽ‡ç­‰ç»Ÿè®¡æ•°æ®

## æŠ€æœ¯ä¼˜åŠ¿

- **éžä¾µå…¥å¼**: ä¸å½±å“çŽ°æœ‰åŠŸèƒ½ï¼Œçº¯å¢žé‡å¼€å‘
- **é«˜æ€§èƒ½**: æ‡’åŠ è½½å’Œæ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- **å¯æ‰©å±•**: æ˜“äºŽæ·»åŠ æ–°çš„åŽ†å²è®°å½•åŠŸèƒ½
- **ç”¨æˆ·å‹å¥½**: ç›´è§‚çš„ç•Œé¢è®¾è®¡å’Œäº¤äº’ä½“éªŒ
